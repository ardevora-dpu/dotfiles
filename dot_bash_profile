# Quinlan Git Bash profile (Windows native)
# Managed by chezmoi - edit in the Ardevora dotfiles repository.

# Tell Claude Code where to find bash for shell operations
export CLAUDE_CODE_GIT_BASH_PATH='C:\Program Files\Git\bin\bash.exe'

# Workspace root for project navigation (p, dev functions)
# Derived from ~/.quinlan-repo (set by /update) â€” parent directory of the repo
if [[ -f ~/.quinlan-repo ]]; then
    WORKSPACE_ROOT="$(dirname "$(cat ~/.quinlan-repo)")"
    export WORKSPACE_ROOT
fi

# Normalise Windows PATH to MSYS paths when needed.
if [[ "$PATH" == *";"* ]] && [[ -x /usr/bin/cygpath ]]; then
    PATH="$(/usr/bin/cygpath -u -p "$PATH")"
fi

case ":$PATH:" in *":/usr/bin:"*) ;; *) PATH="/usr/bin:$PATH" ;; esac
case ":$PATH:" in *":/mingw64/bin:"*) ;; *) PATH="/mingw64/bin:$PATH" ;; esac
export PATH

# Fix Claude Code's Windows-format PATH in bash tool subprocesses.
# Node.js converts PATH to Windows format; the shell snapshot replays it after
# /etc/profile and BASH_ENV have already converted. The DEBUG trap fires after
# the snapshot loads and restores Unix-format PATH before the command runs.
# Gated on _QUINLAN_UNIX_PATH (set by cc launcher) so interactive shells are
# unaffected.
if [[ -n "${_QUINLAN_UNIX_PATH:-}" ]]; then
    _quinlan_fix_path() {
        if [[ "$PATH" == *";"* ]]; then
            PATH="$_QUINLAN_UNIX_PATH"
            export PATH
            trap - DEBUG
        fi
    }
    trap '_quinlan_fix_path' DEBUG
fi

# Source .bashrc for interactive shell customisations
if [ -f ~/.bashrc ]; then
    # shellcheck source=/dev/null
    source ~/.bashrc
fi

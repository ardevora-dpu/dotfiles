# Quinlan Git Bash profile (Windows native)
# Managed by chezmoi. Do not edit ~/.bashrc directly.

_quinlan_uname="$(uname -s 2>/dev/null || true)"
case "$_quinlan_uname" in
    MINGW*|MSYS*|CYGWIN*)
        export CLAUDE_CODE_GIT_BASH_PATH='C:\Program Files\Git\bin\bash.exe'
        ;;
    *)
        unset CLAUDE_CODE_GIT_BASH_PATH
        ;;
esac
unset _quinlan_uname

# BASH_ENV: sourced by bash for non-interactive shells (Claude Code sandbox).
# Also set in ~/.claude/settings.json env block for launch-context independence.
export BASH_ENV="$HOME/.config/quinlan-shell/bash-env.sh"

_QUINLAN_MODULE_ROOT="$HOME/.config/quinlan-shell/modules"

_quinlan_source_required_module() {
    local module_name="$1"
    local module_path="${_QUINLAN_MODULE_ROOT}/${module_name}"

    if [[ ! -f "$module_path" ]]; then
        echo "[quinlan-shell] Missing required module: $module_path" >&2
        echo "[quinlan-shell] Run: chezmoi apply --force" >&2
        return 1
    fi

    # shellcheck source=/dev/null
    source "$module_path"
}

_quinlan_source_optional_module() {
    local module_name="$1"
    local module_path="${_QUINLAN_MODULE_ROOT}/${module_name}"

    if [[ -f "$module_path" ]]; then
        # shellcheck source=/dev/null
        source "$module_path"
    fi
}

if [[ ! -d "$_QUINLAN_MODULE_ROOT" ]]; then
    echo "[quinlan-shell] Missing module directory: $_QUINLAN_MODULE_ROOT" >&2
    echo "[quinlan-shell] Run: chezmoi apply --force" >&2
else
    _quinlan_source_required_module "path.sh"
    _quinlan_source_required_module "auto-env.sh"
    _quinlan_source_required_module "claude.sh"
    _quinlan_source_required_module "project.sh"

    # Timon-only modules are present only when deployed by chezmoi gating.
    _quinlan_source_optional_module "codex-wsl.sh"
    _quinlan_source_optional_module "gemini.sh"
    _quinlan_source_optional_module "local.sh"
fi

unset -f _quinlan_source_required_module
unset -f _quinlan_source_optional_module
unset _QUINLAN_MODULE_ROOT
